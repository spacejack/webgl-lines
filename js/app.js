!function e(t,n,r){function o(a,s){if(!n[a]){if(!t[a]){var u="function"==typeof require&&require;if(!s&&u)return u(a,!0);if(i)return i(a,!0);var l=new Error("Cannot find module '"+a+"'");throw l.code="MODULE_NOT_FOUND",l}var c=n[a]={exports:{}};t[a][0].call(c.exports,(function(e){return o(t[a][1][e]||e)}),c,c.exports,e,t,n,r)}return n[a].exports}for(var i="function"==typeof require&&require,a=0;a<r.length;a++)o(r[a]);return o}({1:[function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var o=Object.getOwnPropertyDescriptor(t,n);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,o)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&r(t,e,n);return o(t,e),t};Object.defineProperty(n,"__esModule",{value:!0});const a=i(e("three")),s=e("./math3d");function u(e){return{position:e.position}}!function(e){function t(e){if(e.length%3!=0)throw new Error("genNormals: Array length not divisible by 3");const t=new Float32Array(e.length);if(e.length<6)return console.warn("genNormals: Array contains less than 2 positions"),t[0]=1,t;h.set(e[3]-e[0],e[4]-e[1],e[5]-e[2]).normalize(),t[0]=h.x,t[1]=h.y,t[2]=h.z;let n=e.length-6;h.set(e[n+3]-e[n+0],e[n+4]-e[n+1],e[n+5]-e[n+2]).normalize(),t[n+0]=h.x,t[n+1]=h.y,t[n+2]=h.z;const r=(e.length-6)/3;for(let o=1;o<r;++o)n=3*(o-1),l.set(e[n+0],e[n+1],e[n+2]),n=3*o,c.set(e[n+0],e[n+1],e[n+2]),h.set(c.x-l.x,c.y-l.y,c.z-l.z).normalize(),n=3*(o+1),l.set(e[n+0],e[n+1],e[n+2]),m.set(l.x-c.x,l.y-c.y,l.z-c.z).normalize(),h.add(m).normalize(),n=3*o,t[n+0]=h.x,t[n+1]=h.y,t[n+2]=h.z;return t}function n(e,t,n){if(e.length<2||t<=e[0])return n[1]=n[0]=0,n;let r=0,o=e.length-1;if(t>=e[o])return n[1]=n[0]=o,n;for(;o>r+1;){let i=Math.floor((r+o)/2);if(e[i]<t)r=i;else if(e[i]>t)o=i;else if(e[i]===t)return n[1]=n[0]=i,n}return e[r]===t?n[1]=n[0]=r:e[o]===t?n[1]=n[0]=o:(n[0]=r,n[1]=o),n}e.genVtx=function(e,n,r,o=3){if(!Number.isSafeInteger(o)||o<3)throw new Error("Invalid inStride: "+o);if(e.length<2*o||e.length%o!=0)throw new Error("Invalid positions array length: "+e.length);if(!Number.isSafeInteger(n)||n<1||n>127)throw new Error("Planes count out of bounds: "+n);const i=t(e),a=e.length/o,u=2*a,c=new Float32Array(u*n*4);for(let t=0;t<n;++t)for(let m=0;m<a;++m)for(let v=0;v<2;++v){const p=2*v-1;let g=m*o,_=4*(u*t+2*m+v);l.set(e[g+0],e[g+1],e[g+2]),h.set(i[g+0],i[g+1],i[g+2]);const y=Math.PI*t/n,x=f.set(h.x,h.z),w=d.set(0,r*p*Math.cos(y));(0,s.rotate2dv)(w,x,w),l.set(l.x+w.x,l.y+r*p*Math.sin(y),l.z+w.y),c[_+0]=l.x,c[_+1]=l.y,c[_+2]=l.z,c[_+3]=a*t+m}return c},e.genIndices=function(e,t){const n=[1,0,2,2,3,1],r=e-1;return Array.from({length:6*r*t},((e,t)=>{const o=Math.floor(t/(6*r));return 2*(Math.floor(t/6)+o)+n[t%6]}))},e.genUVs=function(e,t,n=2){const r=e*n,o=new Float32Array(r*t*n);for(let i=0;i<t;++i)for(let t=0;t<e;++t)for(let e=0;e<2;++e){const a=(r*i+2*t+e)*n;o[a+0]=e,o[a+1]=t}return o},e.vtxPosAt=function(e,t,n,r,o,i,u){const l=new a.Vector2(t.x,t.z).normalize(),c=Math.PI*r/o,f=new a.Vector3(0,n*Math.sin(c),n*Math.cos(c)),d=(0,s.rotate2dv)({x:f.x,y:f.z},l,{x:0,y:0}),h=2*i*o+r;return u[h+0]=e.x+d.x,u[h+1]=e.y+f.y,u[h+2]=e.z+d.y,u},e.normalAt=function(e,t,n){const r=t>=e.length/3-1,o=3*(r?t:t-1),i=3*(r?t+1:t);return n.set(e[i+0]-e[o+0],e[i+1]-e[o+1],e[i+2]-e[o+2]).normalize()},e.genTangents=t,e.genNormalsI=function(e){if(e.length%3!=0)throw new Error("genNormals: Array length not divisible by 3");const t=Math.floor(e.length/3),n=new Float32Array(4*t);if(t<2)return console.warn("genNormals: Array contains less than 2 positions"),t>0&&(n[0]=1),n;const r=t-2;h.set(e[3]-e[0],e[4]-e[1],e[5]-e[2]).normalize(),n[0]=h.x,n[1]=h.y,n[2]=h.z,n[3]=0;let o=e.length-6,i=4*(t-1);h.set(e[o+3]-e[o+0],e[o+4]-e[o+1],e[o+5]-e[o+2]).normalize(),n[i+0]=h.x,n[i+1]=h.y,n[i+2]=h.z,n[i+3]=t-1;for(let t=1;t<r;++t)o=3*(t-1),l.set(e[o+0],e[o+1],e[o+2]),o=3*t,c.set(e[o+0],e[o+1],e[o+2]),h.set(c.x-l.x,c.y-l.y,c.z-l.z).normalize(),o=3*(t+1),l.set(e[o+0],e[o+1],e[o+2]),m.set(l.x-c.x,l.y-c.y,l.z-c.z).normalize(),h.add(m).normalize(),i=4*t,n[i+0]=h.x,n[i+1]=h.y,n[i+2]=h.z,n[i+3]=t;return n},e.posAtTime=function(e,t,r){const o=e.position.values,i=e.position.times,[a,u]=n(i,t,v),l=u>a?(t-i[a])/(i[u]-i[a]):0,c=3*a,f=3*u;return r.x=(0,s.lerp)(o[c+0],o[f+0],l),r.y=(0,s.lerp)(o[c+1],o[f+1],l),r.z=(0,s.lerp)(o[c+2],o[f+2],l),r},e.boundsSearch=n,e.indexPos=function(e,t){if(e.length<2||t<=e[0])return 0;let n=0,r=e.length-1;if(t>=e[r])return r;for(;r>n+1;){let o=Math.floor((n+r)/2);if(e[o]<t)n=o;else if(e[o]>t)r=o;else if(e[o]===t)return o}if(e[n]===t)return n;if(e[r]===t)return r;const o=e[n];return n+(t-o)/(e[r]-o)}}(u||(u={})),n.default=u;const l=new a.Vector3,c=new a.Vector3,f=new a.Vector2,d=new a.Vector2,h=new a.Vector3,m=new a.Vector3,v=(new a.Quaternion,[0,0])},{"./math3d":3,three:void 0}],2:[function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var o=Object.getOwnPropertyDescriptor(t,n);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,o)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&r(t,e,n);return o(t,e),t},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});const s=i(e("three")),u=a(e("./BeamData")),l=[1,1,1,1];class c extends s.Group{animData;duration=0;size=1;planes=2;color=[...l];flareTexture;trailMesh;constructor(e){if(super(),null!=e.planes){if(!Number.isSafeInteger(e.planes)||e.planes<2)throw new Error(`Invalid number of planes: ${e.planes} (must be int >= 2)`);this.planes=e.planes}this.animData={...e.data},this.duration=this.animData.position.times[this.animData.position.times.length-1],this.size=e.size,Array.isArray(e.color)&&(this.color=[...e.color]),this.trailMesh=c.createTrailMesh({...e,color:this.color}),this.trailMesh.scale.set(500,500,500),this.trailMesh.frustumCulled=!1,this.add(this.trailMesh)}render(e,t,n){const r=u.default.indexPos(this.animData.position.times,e);this.trailMesh.material.uniforms.time.value=r}static createTrailMesh({data:e,size:t,planes:n=2,color:r=[...l]}){const o=u.default.genVtx(e.position.values,n,t),i=u.default.genUVs(e.position.values.length,n),a=u.default.genIndices(e.position.values.length/3,n),c=new s.BufferGeometry;c.setAttribute("vertex",new s.BufferAttribute(o,4)),c.setAttribute("texcoord",new s.BufferAttribute(i,2)),c.setIndex(a);const d=o.length/4/2/n,h=new s.RawShaderMaterial({uniforms:{color:{value:[...r]},time:{value:0},planeEdgeCount:{value:d}},vertexShader:f.vertex,fragmentShader:f.fragment,transparent:!0,depthTest:!0,depthWrite:!1,side:s.DoubleSide});return new s.Mesh(c,h)}}n.default=c;const f={vertex:`\nprecision highp float;\n\nconst float PI = ${Math.PI};\nconst float PI2 = ${2*Math.PI};\n\nattribute vec4 vertex;\nattribute vec2 texcoord;\n\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\n\nuniform vec4 color;\nuniform float planeEdgeCount;\n// Animation time from 0..1\nuniform float time;\n// Position data contained in texture\n//uniform sampler2D data;\n\n// Varyings forwarded to frag shader\nvarying vec2 vUv;\nvarying vec4 vColor;\n\nvoid main() {\n\tfloat vindex = vertex.w;\n\tfloat pindex = mod(vindex, planeEdgeCount);\n\t//float planeVtx = mod(vindex, planeEdgeCount);\n\t//float seg = planeVtx; //floor(planeVtx / 2.0);\n\t//vUv = vec2(mod(planeVtx, 2.0), seg);\n\tvUv = texcoord;\n\tvColor = time > pindex ? color : vec4(color.rgb, color.a * 0.125);\n\t//vColor = color;\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4(vertex.xyz, 1.0);\n}`,fragment:"\nprecision highp float;\n\n//uniform sampler2D map;\n\nvarying vec2 vUv;\nvarying vec4 vColor;\n\n// Rather than using a loaded texture, we can render a simple\n// gradient procedural texture to represent the line edges\nvec4 lineColor (float x) {\n\t// Exponentially fade off toward the edges\n\tfloat a = x < 0.5 ? x : 1.0 - x;\n\ta = a * 2.0;\n\treturn vec4(1.0, 1.0, 1.0, a * a);\n}\n\nvoid main() {\n\t// sample color from texture\n\t//gl_FragColor = vColor * texture2D(map, vUv);\n\tgl_FragColor = vColor * lineColor(vUv.x);\n}\n"}},{"./BeamData":1,three:void 0}],3:[function(e,t,n){"use strict";function r(e,t){return(e%t+t)%t}Object.defineProperty(n,"__esModule",{value:!0}),n.minOf=n.maxOf=n.extents3d=n.distXZ=n.arrayToV3=n.v3toArray=n.rotate2dv=n.rotate2d=n.lerp=n.difAngle=n.angleOf=n.pmod=n.clamp=n.PI2=void 0,n.PI2=2*Math.PI,n.clamp=function(e,t,n){return Math.min(Math.max(e,t),n)},n.pmod=r,n.angleOf=function(e,t){return r(Math.atan2(t,e),n.PI2)},n.difAngle=function(e,t){const o=r(t,n.PI2)-r(e,n.PI2);return Math.abs(o)<Math.PI?o:o-n.PI2*Math.sign(o)},n.lerp=function(e,t,n){return e*(1-n)+t*n},n.rotate2d=function(e,t){const n=Math.cos(t),r=Math.sin(t),o=e.x,i=e.y;return{x:o*n-i*r,y:o*r+i*n}},n.rotate2dv=function(e,t,n){const r=t.x,o=t.y,i=e.x,a=e.y;return n.x=i*r-a*o,n.y=i*o+a*r,n},n.v3toArray=function(e,t,n=0){return t[n+0]=e.x,t[n+1]=e.y,t[n+2]=e.z,t},n.arrayToV3=function(e,t,n=0){return t.x=e[n+0],t.y=e[n+1],t.z=e[n+2],t},n.distXZ=function(e,t){const n=t.x-e.x,r=t.z-e.z;return Math.sqrt(n*n+r*r)},n.extents3d=function(e,t=3){const n={x0:e[0],x1:e[0],y0:e[1],y1:e[1],z0:e[2],z1:e[2]},r=e.length/t;for(let o=0;o<r;++o){const r=o*t;e[r+0]<n.x0&&(n.x0=e[r+0]),e[r+0]>n.x1&&(n.x1=e[r+0]),e[r+1]<n.y0&&(n.y0=e[r+1]),e[r+1]>n.y1&&(n.y1=e[r+1]),e[r+2]<n.z0&&(n.z0=e[r+2]),e[r+2]>n.z1&&(n.z1=e[r+2])}return n},n.maxOf=function(e){let t=e[0];if(e.length<2)return t;for(let n=1;n<e.length;++n)e[n]>t&&(t=e[n]);return t},n.minOf=function(e){let t=e[0];if(e.length<2)return t;for(let n=1;n<e.length;++n)e[n]<t&&(t=e[n]);return t}},{}],4:[function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var o=Object.getOwnPropertyDescriptor(t,n);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,o)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&r(t,e,n);return o(t,e),t},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});const s=i(e("three")),u=e("./config"),l=e("../Beam3D/math3d"),c=a(e("../Beam3D"));function f(e,t=100){return{position:{values:new Float32Array(3*t).map(((n,r)=>{const o=Math.floor(r/3)/t,i=Math.sin(o*Math.PI),a=r%3,s=12*l.PI2*o;return 0===a?i*e*Math.cos(s):1===a?(o-.5)*e*2:i*e*Math.sin(s)})),times:new Float32Array(t).map(((e,n)=>u.BEAM_DURATION*n/t))}}}n.default=function(e){const t=new s.Scene,n=new s.WebGLRenderer({canvas:e}),r=new s.PerspectiveCamera(40,e.width/e.height,1,u.VIEW_DISTANCE);r.position.z=u.CAMERA_RADIUS,t.add(r);const o=new s.PointLight(16777215,1,u.VIEW_DISTANCE,.25);o.position.set(0,0,0),t.add(o);const i=new s.AmbientLight(4473924);t.add(i);const a=new c.default({data:f(.025,1200),size:.00125,color:[.2,.8,.5,1]});return a.rotation.x=Math.PI/2,a.position.set(0,0,0),t.add(a),{scene:t,renderer:n,camera:r,sunLight:o,ambientLight:i,render:function(e,o,i){a.render(e,o,i),n.render(t,r)}}}},{"../Beam3D":2,"../Beam3D/math3d":3,"./config":5,three:void 0}],5:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.CAMERA_RADIUS=n.BEAM_DURATION=n.MARS_ORBIT_RADIUS=n.EARTH_ORBIT_RADIUS=n.EARTH_MARS_ORBIT_RATIO=n.VIEW_DISTANCE=void 0,n.VIEW_DISTANCE=1e3,n.EARTH_MARS_ORBIT_RATIO=1.568400379,n.EARTH_ORBIT_RADIUS=12,n.MARS_ORBIT_RADIUS=n.EARTH_ORBIT_RADIUS*n.EARTH_MARS_ORBIT_RATIO,n.BEAM_DURATION=10,n.CAMERA_RADIUS=60},{}],6:[function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var o=Object.getOwnPropertyDescriptor(t,n);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,o)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&r(t,e,n);return o(t,e),t},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});const s=i(e("three")),u=e("../Beam3D/math3d"),l=a(e("../lib/Ptr")),c=a(e("./Graphics")),f=e("./config"),d=.3*f.CAMERA_RADIUS,h=1.5*f.CAMERA_RADIUS,m=new s.Vector3(0,0,0);n.default=function(e){let t=0,n=0,r=0,o=!1;const i={x:640,y:480};let a,s,v=f.CAMERA_RADIUS,p=0,g=0;const _=(0,c.default)(e);window.addEventListener("resize",M),requestAnimationFrame(M);const y=(0,l.default)(e,{down:e=>{a={x:e.x,y:e.y},s={...a},console.log("dragStart:",a)},move:e=>{s&&(p=(0,u.pmod)(p+Math.PI*(e.x-s.x)/i.x,2*Math.PI),g=(0,u.clamp)(g+Math.PI*(e.y-s.y)/i.x,-Math.PI/2,Math.PI/2),s.x=e.x,s.y=e.y)},up:e=>{console.log("dragEnd:",{x:e.x,y:e.y}),s=a=void 0}});function x(e){v=(0,u.clamp)(v+.02*e.deltaY,d,h)}function w(){if(!o)return;const e=Date.now();let i=e-n;i>0&&(i>100&&(n+=i-100,i=100),t+=i,_.camera.position.x=v*Math.cos(p),_.camera.position.z=v*Math.sin(p),_.camera.position.y=v*Math.sin(g),_.camera.position.setLength(v),_.camera.lookAt(m),function(e,t,n){_.render(e,t,n)}(t/1e3%f.BEAM_DURATION,i,r),r+=1),n=e,requestAnimationFrame(w)}function M(){const t=e.getBoundingClientRect();e.width=i.x=t.width,e.height=i.y=t.height,_.renderer.setSize(i.x,i.y,!1),_.camera.aspect=i.x/i.y,_.camera.updateProjectionMatrix(),_.renderer.render(_.scene,_.camera)}return e.addEventListener("wheel",x),{run:function(){o?console.warn("Game already running"):(o=!0,n=Date.now(),requestAnimationFrame(w))},resize:M,dispose:function(){window.removeEventListener("resize",M),e.removeEventListener("wheel",x),o=!1,y.dispose(),_.renderer.dispose()},time:()=>t}}},{"../Beam3D/math3d":3,"../lib/Ptr":8,"./Graphics":4,"./config":5,three:void 0}],7:[function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});const o=r(e("mithril")),i=r(e("../../Game"));n.default=function(){let e,t,n;return{oncreate:({dom:r})=>{e=r,t=e.querySelector("canvas"),n=(0,i.default)(t),requestAnimationFrame(n.run)},onremove:()=>{n&&(n.dispose(),e=t=n=void 0)},view:()=>(0,o.default)(".app",(0,o.default)("canvas.app-canvas"))}}},{"../../Game":6,mithril:void 0}],8:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.PtrEvent=void 0;class r{type;x;y;domEvent;constructor(e,t,n,r){this.type=e,this.x=t,this.y=n,this.domEvent=r}}n.PtrEvent=r,n.default=function(e,t){let n=0;function o(e){e.preventDefault(),2!==n&&(n=1,window.addEventListener("mousemove",a),window.addEventListener("mouseup",l),t.down&&t.down(new r("down",e.pageX,e.pageY,e)))}function i(o){if(o.preventDefault(),1!==n&&(n=2,e.addEventListener("touchmove",s),e.addEventListener("touchend",c),t.down)){const e=o.changedTouches[0];t.down(new r("down",e.pageX,e.pageY,o))}}function a(e){e.preventDefault(),t.move&&t.move(new r("move",e.pageX,e.pageY,e))}function s(e){if(e.preventDefault(),t.move){const n=e.changedTouches[0];t.move(new r("move",n.pageX,n.pageY,e))}}function u(e,o,i){i.preventDefault();const a=n;setTimeout((()=>{n===a&&(n=0)}),200),t.up&&t.up(new r("up",e,o,i))}function l(e){window.removeEventListener("mouseup",l),window.removeEventListener("mousemove",a),u(e.pageX,e.pageY,e)}function c(t){e.removeEventListener("touchend",c),e.removeEventListener("touchmove",s);const n=t.changedTouches[0];u(n.pageX,n.pageY,t)}return e.addEventListener("mousedown",o),e.addEventListener("touchstart",i),{dispose:function(){window.removeEventListener("mousemove",a),window.removeEventListener("mouseup",l),e.removeEventListener("touchmove",s),e.removeEventListener("touchend",c),e.removeEventListener("mousedown",o),e.removeEventListener("touchstart",i)}}}},{}],9:[function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});const o=r(e("mithril")),i=r(e("./UI/App"));window.addEventListener("DOMContentLoaded",(()=>{o.default.mount(document.body,i.default)})),t.hot&&(t.hot.accept(),t.hot.dispose((e=>{o.default.redraw()})))},{"./UI/App":7,mithril:void 0}]},{},[9]);